{"version":3,"file":"toolbar.js","names":["_quillDelta","_interopRequireDefault","require","_parchment","_quill","_logger","_module","obj","__esModule","default","debug","logger","Toolbar","Module","constructor","quill","options","Array","isArray","container","document","createElement","setAttribute","addControls","parentNode","insertBefore","querySelector","HTMLElement","error","classList","add","controls","handlers","Object","keys","forEach","format","handler","addHandler","from","querySelectorAll","input","attach","on","Quill","events","EDITOR_CHANGE","type","range","SELECTION_CHANGE","update","SCROLL_OPTIMIZE","selection","getRange","find","className","indexOf","slice","length","tagName","scroll","query","warn","eventName","addEventListener","e","value","selectedIndex","selected","hasAttribute","contains","preventDefault","focus","call","prototype","EmbedBlot","prompt","updateContents","Delta","retain","index","delete","insert","sources","USER","push","formats","getFormat","pair","option","replace","remove","isActive","getAttribute","toString","toggle","exports","DEFAULTS","addButton","appendChild","groups","group","control","addSelect","values","String","clean","getSelection","name","Scope","INLINE","removeFormat","direction","align","indent","parseInt","modifier","link","list"],"sources":["../../src/modules/toolbar.ts"],"sourcesContent":["import Delta from 'quill-delta';\nimport { EmbedBlot, Scope } from 'parchment';\nimport Quill from '../core/quill';\nimport logger from '../core/logger';\nimport Module from '../core/module';\nimport type { Range } from '../core/selection';\n\nconst debug = logger('quill:toolbar');\n\ntype Handler = (value: any) => void;\n\nexport type ToolbarConfig = Array<\n  string[] | Array<string | Record<string, unknown>>\n>;\nexport interface ToolbarProps {\n  container?: HTMLElement | ToolbarConfig | null;\n  handlers?: Record<string, Handler>;\n  option?: number;\n  module?: boolean;\n  theme?: boolean;\n}\n\nclass Toolbar extends Module<ToolbarProps> {\n  static DEFAULTS: ToolbarProps;\n\n  container?: HTMLElement | null;\n  controls: [string, HTMLElement][];\n  handlers: Record<string, Handler>;\n\n  constructor(quill: Quill, options: Partial<ToolbarProps>) {\n    super(quill, options);\n    if (Array.isArray(this.options.container)) {\n      const container = document.createElement('div');\n      container.setAttribute('role', 'toolbar');\n      addControls(container, this.options.container);\n      quill.container?.parentNode?.insertBefore(container, quill.container);\n      this.container = container;\n    } else if (typeof this.options.container === 'string') {\n      this.container = document.querySelector(this.options.container);\n    } else {\n      this.container = this.options.container;\n    }\n    if (!(this.container instanceof HTMLElement)) {\n      debug.error('Container required for toolbar', this.options);\n      return;\n    }\n    this.container.classList.add('ql-toolbar');\n    this.controls = [];\n    this.handlers = {};\n    if (this.options.handlers) {\n      Object.keys(this.options.handlers).forEach((format) => {\n        const handler = this.options.handlers?.[format];\n        if (handler) {\n          this.addHandler(format, handler);\n        }\n      });\n    }\n    Array.from(this.container.querySelectorAll('button, select')).forEach(\n      (input) => {\n        // @ts-expect-error\n        this.attach(input);\n      },\n    );\n    this.quill.on(Quill.events.EDITOR_CHANGE, (type, range) => {\n      if (type === Quill.events.SELECTION_CHANGE) {\n        this.update(range as Range);\n      }\n    });\n    this.quill.on(Quill.events.SCROLL_OPTIMIZE, () => {\n      const [range] = this.quill.selection.getRange(); // quill.getSelection triggers update\n      this.update(range);\n    });\n  }\n\n  addHandler(format: string, handler: Handler) {\n    this.handlers[format] = handler;\n  }\n\n  attach(input: HTMLElement) {\n    let format = Array.from(input.classList).find((className) => {\n      return className.indexOf('ql-') === 0;\n    });\n    if (!format) return;\n    format = format.slice('ql-'.length);\n    if (input.tagName === 'BUTTON') {\n      input.setAttribute('type', 'button');\n    }\n    if (\n      this.handlers[format] == null &&\n      this.quill.scroll.query(format) == null\n    ) {\n      debug.warn('ignoring attaching to nonexistent format', format, input);\n      return;\n    }\n    const eventName = input.tagName === 'SELECT' ? 'change' : 'click';\n    input.addEventListener(eventName, (e) => {\n      let value;\n      if (input.tagName === 'SELECT') {\n        // @ts-expect-error\n        if (input.selectedIndex < 0) return;\n        // @ts-expect-error\n        const selected = input.options[input.selectedIndex];\n        if (selected.hasAttribute('selected')) {\n          value = false;\n        } else {\n          value = selected.value || false;\n        }\n      } else {\n        if (input.classList.contains('ql-active')) {\n          value = false;\n        } else {\n          // @ts-expect-error\n          value = input.value || !input.hasAttribute('value');\n        }\n        e.preventDefault();\n      }\n      this.quill.focus();\n      const [range] = this.quill.selection.getRange();\n      // @ts-expect-error Fix me later\n      if (this.handlers[format] != null) {\n        // @ts-expect-error Fix me later\n        this.handlers[format].call(this, value);\n      } else if (\n        // @ts-expect-error\n        this.quill.scroll.query(format).prototype instanceof EmbedBlot\n      ) {\n        value = prompt(`Enter ${format}`); // eslint-disable-line no-alert\n        if (!value) return;\n        this.quill.updateContents(\n          new Delta()\n            // @ts-expect-error Fix me later\n            .retain(range.index)\n            // @ts-expect-error Fix me later\n            .delete(range.length)\n            // @ts-expect-error Fix me later\n            .insert({ [format]: value }),\n          Quill.sources.USER,\n        );\n      } else {\n        // @ts-expect-error Fix me later\n        this.quill.format(format, value, Quill.sources.USER);\n      }\n      this.update(range);\n    });\n    this.controls.push([format, input]);\n  }\n\n  update(range: Range | null) {\n    const formats = range == null ? {} : this.quill.getFormat(range);\n    this.controls.forEach((pair) => {\n      const [format, input] = pair;\n      if (input.tagName === 'SELECT') {\n        let option: HTMLOptionElement | null = null;\n        if (range == null) {\n          option = null;\n        } else if (formats[format] == null) {\n          option = input.querySelector('option[selected]');\n        } else if (!Array.isArray(formats[format])) {\n          let value = formats[format];\n          if (typeof value === 'string') {\n            value = value.replace(/\"/g, '\\\\\"');\n          }\n          option = input.querySelector(`option[value=\"${value}\"]`);\n        }\n        if (option == null) {\n          // @ts-expect-error TODO fix me later\n          input.value = ''; // TODO make configurable?\n          // @ts-expect-error TODO fix me later\n          input.selectedIndex = -1;\n        } else {\n          option.selected = true;\n        }\n      } else if (range == null) {\n        input.classList.remove('ql-active');\n        input.setAttribute('aria-pressed', 'false');\n      } else if (input.hasAttribute('value')) {\n        // both being null should match (default values)\n        // '1' should match with 1 (headers)\n        const value = formats[format] as boolean | number | string | object;\n        const isActive =\n          value === input.getAttribute('value') ||\n          (value != null && value.toString() === input.getAttribute('value')) ||\n          (value == null && !input.getAttribute('value'));\n        input.classList.toggle('ql-active', isActive);\n        input.setAttribute('aria-pressed', isActive.toString());\n      } else {\n        const isActive = formats[format] != null;\n        input.classList.toggle('ql-active', isActive);\n        input.setAttribute('aria-pressed', isActive.toString());\n      }\n    });\n  }\n}\nToolbar.DEFAULTS = {};\n\nfunction addButton(container: HTMLElement, format: string, value?: string) {\n  const input = document.createElement('button');\n  input.setAttribute('type', 'button');\n  input.classList.add(`ql-${format}`);\n  input.setAttribute('aria-pressed', 'false');\n  if (value != null) {\n    input.value = value;\n    input.setAttribute('aria-label', `${format}: ${value}`);\n  } else {\n    input.setAttribute('aria-label', format);\n  }\n  container.appendChild(input);\n}\n\nfunction addControls(\n  container: HTMLElement,\n  groups:\n    | (string | Record<string, unknown>)[][]\n    | (string | Record<string, unknown>)[],\n) {\n  if (!Array.isArray(groups[0])) {\n    // @ts-expect-error\n    groups = [groups];\n  }\n  groups.forEach((controls: any) => {\n    const group = document.createElement('span');\n    group.classList.add('ql-formats');\n    controls.forEach((control: any) => {\n      if (typeof control === 'string') {\n        addButton(group, control);\n      } else {\n        const format = Object.keys(control)[0];\n        const value = control[format];\n        if (Array.isArray(value)) {\n          addSelect(group, format, value);\n        } else {\n          addButton(group, format, value);\n        }\n      }\n    });\n    container.appendChild(group);\n  });\n}\n\nfunction addSelect(\n  container: HTMLElement,\n  format: string,\n  values: Array<string | boolean>,\n) {\n  const input = document.createElement('select');\n  input.classList.add(`ql-${format}`);\n  values.forEach((value) => {\n    const option = document.createElement('option');\n    if (value !== false) {\n      option.setAttribute('value', String(value));\n    } else {\n      option.setAttribute('selected', 'selected');\n    }\n    input.appendChild(option);\n  });\n  container.appendChild(input);\n}\n\nToolbar.DEFAULTS = {\n  container: null,\n  handlers: {\n    clean() {\n      const range = this.quill.getSelection();\n      if (range == null) return;\n      if (range.length === 0) {\n        const formats = this.quill.getFormat();\n        Object.keys(formats).forEach((name) => {\n          // Clean functionality in existing apps only clean inline formats\n          if (this.quill.scroll.query(name, Scope.INLINE) != null) {\n            this.quill.format(name, false, Quill.sources.USER);\n          }\n        });\n      } else {\n        this.quill.removeFormat(range, Quill.sources.USER);\n      }\n    },\n    direction(value) {\n      const { align } = this.quill.getFormat();\n      if (value === 'rtl' && align == null) {\n        this.quill.format('align', 'right', Quill.sources.USER);\n      } else if (!value && align === 'right') {\n        this.quill.format('align', false, Quill.sources.USER);\n      }\n      this.quill.format('direction', value, Quill.sources.USER);\n    },\n    indent(value) {\n      const range = this.quill.getSelection();\n      const formats = this.quill.getFormat(range);\n      const indent = parseInt(formats.indent || 0, 10);\n      if (value === '+1' || value === '-1') {\n        let modifier = value === '+1' ? 1 : -1;\n        if (formats.direction === 'rtl') modifier *= -1;\n        this.quill.format('indent', indent + modifier, Quill.sources.USER);\n      }\n    },\n    link(value) {\n      if (value === true) {\n        value = prompt('Enter link URL:'); // eslint-disable-line no-alert\n      }\n      this.quill.format('link', value, Quill.sources.USER);\n    },\n    list(value) {\n      const range = this.quill.getSelection();\n      const formats = this.quill.getFormat(range);\n      if (value === 'check') {\n        if (formats.list === 'checked' || formats.list === 'unchecked') {\n          this.quill.format('list', false, Quill.sources.USER);\n        } else {\n          this.quill.format('list', 'unchecked', Quill.sources.USER);\n        }\n      } else {\n        this.quill.format('list', value, Quill.sources.USER);\n      }\n    },\n  },\n};\n\nexport { Toolbar as default, addControls };\n"],"mappings":"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"}