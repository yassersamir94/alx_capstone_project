{"version":3,"file":"clipboard.js","names":["_parchment","require","_quillDelta","_interopRequireDefault","_block","_logger","_module","_quill","_align","_background","_code","_color","_direction","_font","_size","_keyboard","obj","__esModule","default","debug","logger","CLIPBOARD_CONFIG","Node","TEXT_NODE","matchText","matchNewline","matchBreak","ELEMENT_NODE","matchBlot","matchAttributor","matchStyles","matchIndent","matchList","matchCodeBlock","matchTable","matchAlias","bind","matchIgnore","ATTRIBUTE_ATTRIBUTORS","AlignAttribute","DirectionAttribute","reduce","memo","attr","keyName","STYLE_ATTRIBUTORS","AlignStyle","BackgroundStyle","ColorStyle","DirectionStyle","FontStyle","SizeStyle","Clipboard","Module","constructor","quill","options","root","addEventListener","e","onCaptureCopy","onCapturePaste","matchers","concat","forEach","_ref","selector","matcher","addMatcher","push","convert","_ref2","html","text","formats","arguments","length","undefined","CodeBlock","blotName","Delta","insert","delta","convertHTML","deltaEndsWith","ops","attributes","table","compose","retain","delete","doc","DOMParser","parseFromString","container","body","nodeMatches","WeakMap","elementMatchers","textMatchers","prepareMatching","traverse","scroll","dangerouslyPasteHTML","index","source","Quill","sources","API","setContents","setSelection","SILENT","paste","updateContents","isCut","defaultPrevented","preventDefault","range","selection","getRange","onCopy","clipboardData","setData","deleteRange","isEnabled","getSelection","getData","files","Array","from","uploader","upload","childElementCount","firstElementChild","tagName","onPaste","getText","getSemanticHTML","_ref3","getFormat","pastedDelta","log","USER","scrollSelectionIntoView","pair","querySelectorAll","node","has","matches","get","set","exports","DEFAULTS","applyFormat","format","value","Object","keys","newDelta","key","op","endText","i","slice","isLine","childNodes","includes","toLowerCase","preNodes","isPre","parentNode","nodeType","childNode","childrenDelta","reducedDelta","Attributor","classes","ClassAttributor","styles","StyleAttributor","name","query","Scope","ATTRIBUTE","attrName","match","prototype","EmbedBlot","embed","BlockBlot","language","indent","parent","composed","list","nextSibling","BlockEmbed","firstChild","style","fontStyle","italic","textDecoration","underline","strike","fontWeight","startsWith","parseInt","bold","parseFloat","textIndent","parentElement","rows","row","indexOf","data","trim","replacer","collapse","replaced","replace","previousSibling","Element"],"sources":["../../src/modules/clipboard.ts"],"sourcesContent":["import type { ScrollBlot } from 'parchment';\nimport {\n  Attributor,\n  BlockBlot,\n  ClassAttributor,\n  EmbedBlot,\n  Scope,\n  StyleAttributor,\n} from 'parchment';\nimport Delta from 'quill-delta';\nimport { BlockEmbed } from '../blots/block';\nimport type { EmitterSource } from '../core/emitter';\nimport logger from '../core/logger';\nimport Module from '../core/module';\nimport Quill from '../core/quill';\nimport type { Range } from '../core/selection';\nimport { AlignAttribute, AlignStyle } from '../formats/align';\nimport { BackgroundStyle } from '../formats/background';\nimport CodeBlock from '../formats/code';\nimport { ColorStyle } from '../formats/color';\nimport { DirectionAttribute, DirectionStyle } from '../formats/direction';\nimport { FontStyle } from '../formats/font';\nimport { SizeStyle } from '../formats/size';\nimport { deleteRange } from './keyboard';\n\nconst debug = logger('quill:clipboard');\n\ntype Selector = string | Node['TEXT_NODE'] | Node['ELEMENT_NODE'];\ntype Matcher = (node: Node, delta: Delta, scroll: ScrollBlot) => Delta;\n\nconst CLIPBOARD_CONFIG: [Selector, Matcher][] = [\n  [Node.TEXT_NODE, matchText],\n  [Node.TEXT_NODE, matchNewline],\n  ['br', matchBreak],\n  [Node.ELEMENT_NODE, matchNewline],\n  [Node.ELEMENT_NODE, matchBlot],\n  [Node.ELEMENT_NODE, matchAttributor],\n  [Node.ELEMENT_NODE, matchStyles],\n  ['li', matchIndent],\n  ['ol, ul', matchList],\n  ['pre', matchCodeBlock],\n  ['tr', matchTable],\n  ['b', matchAlias.bind(matchAlias, 'bold')],\n  ['i', matchAlias.bind(matchAlias, 'italic')],\n  ['strike', matchAlias.bind(matchAlias, 'strike')],\n  ['style', matchIgnore],\n];\n\nconst ATTRIBUTE_ATTRIBUTORS = [AlignAttribute, DirectionAttribute].reduce(\n  (memo: Record<string, Attributor>, attr) => {\n    memo[attr.keyName] = attr;\n    return memo;\n  },\n  {},\n);\n\nconst STYLE_ATTRIBUTORS = [\n  AlignStyle,\n  BackgroundStyle,\n  ColorStyle,\n  DirectionStyle,\n  FontStyle,\n  SizeStyle,\n].reduce((memo: Record<string, Attributor>, attr) => {\n  memo[attr.keyName] = attr;\n  return memo;\n}, {});\n\ninterface ClipboardOptions {\n  matchers: [Selector, Matcher][];\n}\n\nclass Clipboard extends Module<ClipboardOptions> {\n  static DEFAULTS: ClipboardOptions;\n\n  matchers: [Selector, Matcher][];\n\n  constructor(quill: Quill, options: Partial<ClipboardOptions>) {\n    super(quill, options);\n    this.quill.root.addEventListener('copy', (e) =>\n      this.onCaptureCopy(e, false),\n    );\n    this.quill.root.addEventListener('cut', (e) => this.onCaptureCopy(e, true));\n    this.quill.root.addEventListener('paste', this.onCapturePaste.bind(this));\n    this.matchers = [];\n    // @ts-expect-error Fix me later\n    CLIPBOARD_CONFIG.concat(this.options.matchers).forEach(\n      ([selector, matcher]) => {\n        this.addMatcher(selector, matcher);\n      },\n    );\n  }\n\n  addMatcher(selector: Selector, matcher: Matcher) {\n    this.matchers.push([selector, matcher]);\n  }\n\n  convert(\n    { html, text }: { html?: string; text?: string },\n    formats: Record<string, unknown> = {},\n  ) {\n    if (formats[CodeBlock.blotName]) {\n      return new Delta().insert(text || '', {\n        [CodeBlock.blotName]: formats[CodeBlock.blotName],\n      });\n    }\n    if (!html) {\n      return new Delta().insert(text || '');\n    }\n    const delta = this.convertHTML(html);\n    // Remove trailing newline\n    if (\n      deltaEndsWith(delta, '\\n') &&\n      (delta.ops[delta.ops.length - 1].attributes == null || formats.table)\n    ) {\n      return delta.compose(new Delta().retain(delta.length() - 1).delete(1));\n    }\n    return delta;\n  }\n\n  convertHTML(html: string) {\n    const doc = new DOMParser().parseFromString(html, 'text/html');\n    const container = doc.body;\n    const nodeMatches = new WeakMap();\n    const [elementMatchers, textMatchers] = this.prepareMatching(\n      container,\n      nodeMatches,\n    );\n    return traverse(\n      this.quill.scroll,\n      container,\n      elementMatchers,\n      textMatchers,\n      nodeMatches,\n    );\n  }\n\n  dangerouslyPasteHTML(html: string, source?: EmitterSource): void;\n  dangerouslyPasteHTML(\n    index: number,\n    html: string,\n    source?: EmitterSource,\n  ): void;\n  dangerouslyPasteHTML(\n    index: number | string,\n    html?: string,\n    source: EmitterSource = Quill.sources.API,\n  ) {\n    if (typeof index === 'string') {\n      const delta = this.convert({ html: index, text: '' });\n      // @ts-expect-error\n      this.quill.setContents(delta, html);\n      this.quill.setSelection(0, Quill.sources.SILENT);\n    } else {\n      const paste = this.convert({ html, text: '' });\n      this.quill.updateContents(\n        new Delta().retain(index).concat(paste),\n        source,\n      );\n      this.quill.setSelection(index + paste.length(), Quill.sources.SILENT);\n    }\n  }\n\n  onCaptureCopy(e: ClipboardEvent, isCut = false) {\n    if (e.defaultPrevented) return;\n    e.preventDefault();\n    const [range] = this.quill.selection.getRange();\n    if (range == null) return;\n    const { html, text } = this.onCopy(range, isCut);\n    e.clipboardData?.setData('text/plain', text);\n    e.clipboardData?.setData('text/html', html);\n    if (isCut) {\n      deleteRange({ range, quill: this.quill });\n    }\n  }\n\n  onCapturePaste(e: ClipboardEvent) {\n    if (e.defaultPrevented || !this.quill.isEnabled()) return;\n    e.preventDefault();\n    const range = this.quill.getSelection(true);\n    if (range == null) return;\n    const html = e.clipboardData?.getData('text/html');\n    const text = e.clipboardData?.getData('text/plain');\n    const files = Array.from(e.clipboardData?.files || []);\n    if (!html && files.length > 0) {\n      this.quill.uploader.upload(range, files);\n      return;\n    }\n    if (html && files.length > 0) {\n      const doc = new DOMParser().parseFromString(html, 'text/html');\n      if (\n        doc.body.childElementCount === 1 &&\n        doc.body.firstElementChild?.tagName === 'IMG'\n      ) {\n        this.quill.uploader.upload(range, files);\n        return;\n      }\n    }\n    this.onPaste(range, { html, text });\n  }\n\n  onCopy(range: Range, isCut: boolean): { html: string; text: string };\n  onCopy(range: Range) {\n    const text = this.quill.getText(range);\n    const html = this.quill.getSemanticHTML(range);\n    return { html, text };\n  }\n\n  onPaste(range: Range, { text, html }: { text?: string; html?: string }) {\n    const formats = this.quill.getFormat(range.index);\n    const pastedDelta = this.convert({ text, html }, formats);\n    debug.log('onPaste', pastedDelta, { text, html });\n    const delta = new Delta()\n      .retain(range.index)\n      .delete(range.length)\n      .concat(pastedDelta);\n    this.quill.updateContents(delta, Quill.sources.USER);\n    // range.length contributes to delta.length()\n    this.quill.setSelection(\n      delta.length() - range.length,\n      Quill.sources.SILENT,\n    );\n    this.quill.scrollSelectionIntoView();\n  }\n\n  prepareMatching(container: Element, nodeMatches: WeakMap<Node, Matcher[]>) {\n    const elementMatchers: Matcher[] = [];\n    const textMatchers: Matcher[] = [];\n    this.matchers.forEach((pair) => {\n      const [selector, matcher] = pair;\n      switch (selector) {\n        case Node.TEXT_NODE:\n          textMatchers.push(matcher);\n          break;\n        case Node.ELEMENT_NODE:\n          elementMatchers.push(matcher);\n          break;\n        default:\n          Array.from(container.querySelectorAll(selector)).forEach((node) => {\n            if (nodeMatches.has(node)) {\n              const matches = nodeMatches.get(node);\n              matches?.push(matcher);\n            } else {\n              nodeMatches.set(node, [matcher]);\n            }\n          });\n          break;\n      }\n    });\n    return [elementMatchers, textMatchers];\n  }\n}\nClipboard.DEFAULTS = {\n  matchers: [],\n};\n\nfunction applyFormat(delta: Delta, formats: Record<string, unknown>): Delta;\nfunction applyFormat(delta: Delta, format: string, value: unknown): Delta;\nfunction applyFormat(\n  delta: Delta,\n  format: string | Record<string, unknown>,\n  value?: unknown,\n): Delta {\n  if (typeof format === 'object') {\n    return Object.keys(format).reduce((newDelta, key) => {\n      return applyFormat(newDelta, key, format[key]);\n    }, delta);\n  }\n  return delta.reduce((newDelta, op) => {\n    if (op.attributes && op.attributes[format]) {\n      return newDelta.push(op);\n    }\n    const formats = value ? { [format]: value } : {};\n    // @ts-expect-error Fix me later\n    return newDelta.insert(op.insert, { ...formats, ...op.attributes });\n  }, new Delta());\n}\n\nfunction deltaEndsWith(delta: Delta, text: string) {\n  let endText = '';\n  for (\n    let i = delta.ops.length - 1;\n    i >= 0 && endText.length < text.length;\n    --i // eslint-disable-line no-plusplus\n  ) {\n    const op = delta.ops[i];\n    if (typeof op.insert !== 'string') break;\n    endText = op.insert + endText;\n  }\n  return endText.slice(-1 * text.length) === text;\n}\n\nfunction isLine(node: Element) {\n  if (node.childNodes.length === 0) return false; // Exclude embed blocks\n  return [\n    'address',\n    'article',\n    'blockquote',\n    'canvas',\n    'dd',\n    'div',\n    'dl',\n    'dt',\n    'fieldset',\n    'figcaption',\n    'figure',\n    'footer',\n    'form',\n    'h1',\n    'h2',\n    'h3',\n    'h4',\n    'h5',\n    'h6',\n    'header',\n    'iframe',\n    'li',\n    'main',\n    'nav',\n    'ol',\n    'output',\n    'p',\n    'pre',\n    'section',\n    'table',\n    'td',\n    'tr',\n    'ul',\n    'video',\n  ].includes(node.tagName.toLowerCase());\n}\n\nconst preNodes = new WeakMap();\nfunction isPre(node: Node | null) {\n  if (node == null) return false;\n  if (!preNodes.has(node)) {\n    // @ts-expect-error\n    if (node.tagName === 'PRE') {\n      preNodes.set(node, true);\n    } else {\n      preNodes.set(node, isPre(node.parentNode));\n    }\n  }\n  return preNodes.get(node);\n}\n\nfunction traverse(\n  scroll: ScrollBlot,\n  node: ChildNode,\n  elementMatchers: Matcher[],\n  textMatchers: Matcher[],\n  nodeMatches: WeakMap<Node, Matcher[]>,\n): Delta {\n  // Post-order\n  if (node.nodeType === node.TEXT_NODE) {\n    return textMatchers.reduce((delta: Delta, matcher) => {\n      return matcher(node, delta, scroll);\n    }, new Delta());\n  }\n  if (node.nodeType === node.ELEMENT_NODE) {\n    return Array.from(node.childNodes || []).reduce((delta, childNode) => {\n      let childrenDelta = traverse(\n        scroll,\n        childNode,\n        elementMatchers,\n        textMatchers,\n        nodeMatches,\n      );\n      if (childNode.nodeType === node.ELEMENT_NODE) {\n        childrenDelta = elementMatchers.reduce((reducedDelta, matcher) => {\n          return matcher(childNode as HTMLElement, reducedDelta, scroll);\n        }, childrenDelta);\n        childrenDelta = (nodeMatches.get(childNode) || []).reduce(\n          (reducedDelta, matcher) => {\n            return matcher(childNode, reducedDelta, scroll);\n          },\n          childrenDelta,\n        );\n      }\n      return delta.concat(childrenDelta);\n    }, new Delta());\n  }\n  return new Delta();\n}\n\nfunction matchAlias(format: string, node: Element, delta: Delta) {\n  return applyFormat(delta, format, true);\n}\n\nfunction matchAttributor(node: HTMLElement, delta: Delta, scroll: ScrollBlot) {\n  const attributes = Attributor.keys(node);\n  const classes = ClassAttributor.keys(node);\n  const styles = StyleAttributor.keys(node);\n  const formats: Record<string, string | undefined> = {};\n  attributes\n    .concat(classes)\n    .concat(styles)\n    .forEach((name) => {\n      let attr = scroll.query(name, Scope.ATTRIBUTE) as Attributor;\n      if (attr != null) {\n        formats[attr.attrName] = attr.value(node);\n        if (formats[attr.attrName]) return;\n      }\n      attr = ATTRIBUTE_ATTRIBUTORS[name];\n      if (attr != null && (attr.attrName === name || attr.keyName === name)) {\n        formats[attr.attrName] = attr.value(node) || undefined;\n      }\n      attr = STYLE_ATTRIBUTORS[name];\n      if (attr != null && (attr.attrName === name || attr.keyName === name)) {\n        attr = STYLE_ATTRIBUTORS[name];\n        formats[attr.attrName] = attr.value(node) || undefined;\n      }\n    });\n  if (Object.keys(formats).length > 0) {\n    return applyFormat(delta, formats);\n  }\n  return delta;\n}\n\nfunction matchBlot(node: Node, delta: Delta, scroll: ScrollBlot) {\n  const match = scroll.query(node);\n  if (match == null) return delta;\n  // @ts-expect-error\n  if (match.prototype instanceof EmbedBlot) {\n    const embed = {};\n    // @ts-expect-error\n    const value = match.value(node);\n    if (value != null) {\n      // @ts-expect-error\n      embed[match.blotName] = value;\n      // @ts-expect-error\n      return new Delta().insert(embed, match.formats(node, scroll));\n    }\n  } else {\n    // @ts-expect-error\n    if (match.prototype instanceof BlockBlot && !deltaEndsWith(delta, '\\n')) {\n      delta.insert('\\n');\n    }\n    // @ts-expect-error\n    if (typeof match.formats === 'function') {\n      // @ts-expect-error\n      return applyFormat(delta, match.blotName, match.formats(node, scroll));\n    }\n  }\n  return delta;\n}\n\nfunction matchBreak(node: Node, delta: Delta) {\n  if (!deltaEndsWith(delta, '\\n')) {\n    delta.insert('\\n');\n  }\n  return delta;\n}\n\nfunction matchCodeBlock(node: Node, delta: Delta, scroll: ScrollBlot) {\n  const match = scroll.query('code-block');\n  // @ts-expect-error\n  const language = match ? match.formats(node, scroll) : true;\n  return applyFormat(delta, 'code-block', language);\n}\n\nfunction matchIgnore() {\n  return new Delta();\n}\n\nfunction matchIndent(node: Node, delta: Delta, scroll: ScrollBlot) {\n  const match = scroll.query(node);\n  if (\n    match == null ||\n    // @ts-expect-error\n    match.blotName !== 'list' ||\n    !deltaEndsWith(delta, '\\n')\n  ) {\n    return delta;\n  }\n  let indent = -1;\n  let parent = node.parentNode;\n  while (parent != null) {\n    // @ts-expect-error\n    if (['OL', 'UL'].includes(parent.tagName)) {\n      indent += 1;\n    }\n    parent = parent.parentNode;\n  }\n  if (indent <= 0) return delta;\n  return delta.reduce((composed, op) => {\n    if (op.attributes && typeof op.attributes.indent === 'number') {\n      return composed.push(op);\n    }\n    // @ts-expect-error Fix me later\n    return composed.insert(op.insert, { indent, ...(op.attributes || {}) });\n  }, new Delta());\n}\n\nfunction matchList(node: Node, delta: Delta) {\n  // @ts-expect-error\n  const list = node.tagName === 'OL' ? 'ordered' : 'bullet';\n  return applyFormat(delta, 'list', list);\n}\n\nfunction matchNewline(node: Node, delta: Delta, scroll: ScrollBlot) {\n  if (!deltaEndsWith(delta, '\\n')) {\n    // @ts-expect-error\n    if (isLine(node)) {\n      return delta.insert('\\n');\n    }\n    if (delta.length() > 0 && node.nextSibling) {\n      let nextSibling: Node | null = node.nextSibling;\n      while (nextSibling != null) {\n        // @ts-expect-error\n        if (isLine(nextSibling)) {\n          return delta.insert('\\n');\n        }\n        const match = scroll.query(nextSibling);\n        // @ts-expect-error\n        if (match && match.prototype instanceof BlockEmbed) {\n          return delta.insert('\\n');\n        }\n        nextSibling = nextSibling.firstChild;\n      }\n    }\n  }\n  return delta;\n}\n\nfunction matchStyles(node: HTMLElement, delta: Delta) {\n  const formats: Record<string, unknown> = {};\n  const style: Partial<CSSStyleDeclaration> = node.style || {};\n  if (style.fontStyle === 'italic') {\n    formats.italic = true;\n  }\n  if (style.textDecoration === 'underline') {\n    formats.underline = true;\n  }\n  if (style.textDecoration === 'line-through') {\n    formats.strike = true;\n  }\n  if (\n    style.fontWeight?.startsWith('bold') ||\n    // @ts-expect-error Fix me later\n    parseInt(style.fontWeight, 10) >= 700\n  ) {\n    formats.bold = true;\n  }\n  if (Object.keys(formats).length > 0) {\n    delta = applyFormat(delta, formats);\n  }\n  // @ts-expect-error\n  if (parseFloat(style.textIndent || 0) > 0) {\n    // Could be 0.5in\n    return new Delta().insert('\\t').concat(delta);\n  }\n  return delta;\n}\n\nfunction matchTable(node: HTMLTableRowElement, delta: Delta) {\n  const table =\n    node.parentElement?.tagName === 'TABLE'\n      ? node.parentElement\n      : node.parentElement?.parentElement;\n  if (table != null) {\n    const rows = Array.from(table.querySelectorAll('tr'));\n    const row = rows.indexOf(node) + 1;\n    return applyFormat(delta, 'table', row);\n  }\n}\n\nfunction matchText(node: HTMLElement, delta: Delta) {\n  // @ts-expect-error\n  let text = node.data;\n  // Word represents empty line with <o:p>&nbsp;</o:p>\n  if (node.parentElement?.tagName === 'O:P') {\n    return delta.insert(text.trim());\n  }\n  if (!isPre(node)) {\n    if (text.trim().length === 0 && text.includes('\\n')) {\n      return delta;\n    }\n    const replacer = (collapse: unknown, match: string) => {\n      const replaced = match.replace(/[^\\u00a0]/g, ''); // \\u00a0 is nbsp;\n      return replaced.length < 1 && collapse ? ' ' : replaced;\n    };\n    text = text.replace(/\\r\\n/g, ' ').replace(/\\n/g, ' ');\n    text = text.replace(/\\s\\s+/g, replacer.bind(replacer, true)); // collapse whitespace\n    if (\n      (node.previousSibling == null &&\n        node.parentElement != null &&\n        isLine(node.parentElement)) ||\n      (node.previousSibling instanceof Element && isLine(node.previousSibling))\n    ) {\n      text = text.replace(/^\\s+/, replacer.bind(replacer, false));\n    }\n    if (\n      (node.nextSibling == null &&\n        node.parentElement != null &&\n        isLine(node.parentElement)) ||\n      (node.nextSibling instanceof Element && isLine(node.nextSibling))\n    ) {\n      text = text.replace(/\\s+$/, replacer.bind(replacer, false));\n    }\n  }\n  return delta.insert(text);\n}\n\nexport {\n  Clipboard as default,\n  matchAttributor,\n  matchBlot,\n  matchNewline,\n  matchText,\n  traverse,\n};\n"],"mappings":"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"}