{"version":3,"file":"emitter.js","names":["_eventemitter","_interopRequireDefault","require","_instances","_logger","obj","__esModule","default","debug","logger","EVENTS","forEach","eventName","document","addEventListener","_len","arguments","length","args","Array","_key","from","querySelectorAll","node","quill","instances","get","emitter","handleDOM","Emitter","EventEmitter","events","EDITOR_CHANGE","SCROLL_BEFORE_UPDATE","SCROLL_BLOT_MOUNT","SCROLL_BLOT_UNMOUNT","SCROLL_OPTIMIZE","SCROLL_UPDATE","SCROLL_EMBED_UPDATE","SELECTION_CHANGE","TEXT_CHANGE","COMPOSITION_BEFORE_START","COMPOSITION_START","COMPOSITION_BEFORE_END","COMPOSITION_END","sources","API","SILENT","USER","constructor","listeners","on","error","emit","_len2","_key2","log","call","event","_len3","_key3","type","_ref","handler","target","contains","listenDOM","push","_default","exports"],"sources":["../../src/core/emitter.ts"],"sourcesContent":["import EventEmitter from 'eventemitter3';\nimport instances from './instances';\nimport logger from './logger';\n\nconst debug = logger('quill:events');\nconst EVENTS = ['selectionchange', 'mousedown', 'mouseup', 'click'];\n\nEVENTS.forEach((eventName) => {\n  document.addEventListener(eventName, (...args) => {\n    Array.from(document.querySelectorAll('.ql-container')).forEach((node) => {\n      const quill = instances.get(node);\n      if (quill && quill.emitter) {\n        quill.emitter.handleDOM(...args);\n      }\n    });\n  });\n});\n\nclass Emitter extends EventEmitter<string> {\n  static events = {\n    EDITOR_CHANGE: 'editor-change',\n    SCROLL_BEFORE_UPDATE: 'scroll-before-update',\n    SCROLL_BLOT_MOUNT: 'scroll-blot-mount',\n    SCROLL_BLOT_UNMOUNT: 'scroll-blot-unmount',\n    SCROLL_OPTIMIZE: 'scroll-optimize',\n    SCROLL_UPDATE: 'scroll-update',\n    SCROLL_EMBED_UPDATE: 'scroll-embed-update',\n    SELECTION_CHANGE: 'selection-change',\n    TEXT_CHANGE: 'text-change',\n    COMPOSITION_BEFORE_START: 'composition-before-start',\n    COMPOSITION_START: 'composition-start',\n    COMPOSITION_BEFORE_END: 'composition-before-end',\n    COMPOSITION_END: 'composition-end',\n  } as const;\n\n  static sources = {\n    API: 'api',\n    SILENT: 'silent',\n    USER: 'user',\n  } as const;\n\n  // @ts-expect-error listeners is declared in EventEmitter as a function\n  listeners: Record<string, { node: Node; handler: Function }[]>;\n\n  constructor() {\n    super();\n    this.listeners = {};\n    this.on('error', debug.error);\n  }\n\n  emit(...args: unknown[]): boolean {\n    debug.log.call(debug, ...args);\n    // @ts-expect-error\n    return super.emit(...args);\n  }\n\n  handleDOM(event: Event, ...args: unknown[]) {\n    (this.listeners[event.type] || []).forEach(({ node, handler }) => {\n      if (event.target === node || node.contains(event.target as Node)) {\n        handler(event, ...args);\n      }\n    });\n  }\n\n  listenDOM(eventName: string, node: Node, handler: EventListener) {\n    if (!this.listeners[eventName]) {\n      this.listeners[eventName] = [];\n    }\n    this.listeners[eventName].push({ node, handler });\n  }\n}\n\nexport type EmitterSource =\n  (typeof Emitter.sources)[keyof typeof Emitter.sources];\n\nexport default Emitter;\n"],"mappings":"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"}