{"version":3,"file":"composition.js","names":["_embed","_interopRequireDefault","require","_emitter","obj","__esModule","default","Composition","isComposing","constructor","scroll","emitter","setupListeners","domNode","addEventListener","event","handleCompositionStart","handleCompositionEnd","blot","target","Node","find","Embed","emit","Emitter","events","COMPOSITION_BEFORE_START","batchStart","COMPOSITION_START","COMPOSITION_BEFORE_END","batchEnd","COMPOSITION_END","_default","exports"],"sources":["../../src/core/composition.ts"],"sourcesContent":["import Embed from '../blots/embed';\nimport type Scroll from '../blots/scroll';\nimport Emitter from './emitter';\n\nclass Composition {\n  isComposing = false;\n\n  constructor(\n    private scroll: Scroll,\n    private emitter: Emitter,\n  ) {\n    this.setupListeners();\n  }\n\n  private setupListeners() {\n    this.scroll.domNode.addEventListener('compositionstart', (event) => {\n      if (!this.isComposing) {\n        this.handleCompositionStart(event);\n      }\n    });\n\n    this.scroll.domNode.addEventListener('compositionend', (event) => {\n      if (this.isComposing) {\n        this.handleCompositionEnd(event);\n      }\n    });\n  }\n\n  private handleCompositionStart(event: CompositionEvent) {\n    const blot =\n      event.target instanceof Node\n        ? this.scroll.find(event.target, true)\n        : null;\n\n    if (blot && !(blot instanceof Embed)) {\n      this.emitter.emit(Emitter.events.COMPOSITION_BEFORE_START, event);\n      this.scroll.batchStart();\n      this.emitter.emit(Emitter.events.COMPOSITION_START, event);\n      this.isComposing = true;\n    }\n  }\n\n  private handleCompositionEnd(event: CompositionEvent) {\n    this.emitter.emit(Emitter.events.COMPOSITION_BEFORE_END, event);\n    this.scroll.batchEnd();\n    this.emitter.emit(Emitter.events.COMPOSITION_END, event);\n    this.isComposing = false;\n  }\n}\n\nexport default Composition;\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,sBAAA,CAAAC,OAAA;AAEA,IAAAC,QAAA,GAAAF,sBAAA,CAAAC,OAAA;AAAgC,SAAAD,uBAAAG,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAEhC,MAAMG,WAAW,CAAC;EAChBC,WAAW,GAAG,KAAK;EAEnBC,WAAWA,CACDC,MAAc,EACdC,OAAgB,EACxB;IAAA,KAFQD,MAAc,GAAdA,MAAc;IAAA,KACdC,OAAgB,GAAhBA,OAAgB;IAExB,IAAI,CAACC,cAAc,CAAC,CAAC;EACvB;EAEQA,cAAcA,CAAA,EAAG;IACvB,IAAI,CAACF,MAAM,CAACG,OAAO,CAACC,gBAAgB,CAAC,kBAAkB,EAAGC,KAAK,IAAK;MAClE,IAAI,CAAC,IAAI,CAACP,WAAW,EAAE;QACrB,IAAI,CAACQ,sBAAsB,CAACD,KAAK,CAAC;MACpC;IACF,CAAC,CAAC;IAEF,IAAI,CAACL,MAAM,CAACG,OAAO,CAACC,gBAAgB,CAAC,gBAAgB,EAAGC,KAAK,IAAK;MAChE,IAAI,IAAI,CAACP,WAAW,EAAE;QACpB,IAAI,CAACS,oBAAoB,CAACF,KAAK,CAAC;MAClC;IACF,CAAC,CAAC;EACJ;EAEQC,sBAAsBA,CAACD,KAAuB,EAAE;IACtD,MAAMG,IAAI,GACRH,KAAK,CAACI,MAAM,YAAYC,IAAI,GACxB,IAAI,CAACV,MAAM,CAACW,IAAI,CAACN,KAAK,CAACI,MAAM,EAAE,IAAI,CAAC,GACpC,IAAI;IAEV,IAAID,IAAI,IAAI,EAAEA,IAAI,YAAYI,cAAK,CAAC,EAAE;MACpC,IAAI,CAACX,OAAO,CAACY,IAAI,CAACC,gBAAO,CAACC,MAAM,CAACC,wBAAwB,EAAEX,KAAK,CAAC;MACjE,IAAI,CAACL,MAAM,CAACiB,UAAU,CAAC,CAAC;MACxB,IAAI,CAAChB,OAAO,CAACY,IAAI,CAACC,gBAAO,CAACC,MAAM,CAACG,iBAAiB,EAAEb,KAAK,CAAC;MAC1D,IAAI,CAACP,WAAW,GAAG,IAAI;IACzB;EACF;EAEQS,oBAAoBA,CAACF,KAAuB,EAAE;IACpD,IAAI,CAACJ,OAAO,CAACY,IAAI,CAACC,gBAAO,CAACC,MAAM,CAACI,sBAAsB,EAAEd,KAAK,CAAC;IAC/D,IAAI,CAACL,MAAM,CAACoB,QAAQ,CAAC,CAAC;IACtB,IAAI,CAACnB,OAAO,CAACY,IAAI,CAACC,gBAAO,CAACC,MAAM,CAACM,eAAe,EAAEhB,KAAK,CAAC;IACxD,IAAI,CAACP,WAAW,GAAG,KAAK;EAC1B;AACF;AAAC,IAAAwB,QAAA,GAAAC,OAAA,CAAA3B,OAAA,GAEcC,WAAW"}