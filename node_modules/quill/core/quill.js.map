{"version":3,"file":"quill.js","names":["_lodashEs","require","Parchment","_interopRequireWildcard","_quillDelta","_interopRequireDefault","_editor","_emitter","_instances","_logger","_module","_selection","_composition","_theme","_scrollRectIntoView","obj","__esModule","default","_getRequireWildcardCache","e","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","debug","logger","globalRegistry","exports","Registry","ParentBlot","uiClass","Quill","DEFAULTS","bounds","modules","placeholder","readOnly","registry","theme","events","Emitter","sources","version","imports","delta","Delta","parchment","Module","Theme","limit","level","find","node","bubble","arguments","length","undefined","instances","import","name","error","register","path","target","overwrite","attrName","blotName","keys","forEach","key","warn","startsWith","constructor","container","options","expandConfig","html","innerHTML","trim","classList","add","root","addContainer","emitter","ScrollBlot","query","scroll","editor","Editor","selection","Selection","composition","Composition","keyboard","addModule","clipboard","history","uploader","init","on","EDITOR_CHANGE","type","TEXT_CHANGE","toggle","isBlank","SCROLL_UPDATE","source","mutations","oldRange","lastRange","newRange","getRange","selectionInfo","modify","update","SCROLL_EMBED_UPDATE","blot","change","retain","offset","statics","USER","contents","convert","text","setContents","clear","setAttribute","disable","allowReadOnlyEdits","refNode","className","document","createElement","insertBefore","blur","setRange","deleteText","index","overload","enable","editReadOnly","modifier","value","enabled","focus","preventScroll","scrollSelectionIntoView","format","API","range","getSelection","Scope","BLOCK","formatLine","formatText","setSelection","SILENT","formats","getBounds","containerBounds","getBoundingClientRect","bottom","top","height","left","right","width","getContents","getLength","getFormat","getIndex","getLeaf","leaf","getLine","line","getLines","Number","MAX_VALUE","lines","getModule","getSemanticHTML","getHTML","getText","hasFocus","insertEmbed","embed","insertText","isEnabled","off","once","removeFormat","scrollRectIntoView","rect","scrollIntoView","console","delete1","applied","insertContents","delete2","compose","Range","Math","max","setText","insert","updateContents","applyDelta","userConfig","expandedConfig","merge","Error","themeConfig","cloneDeep","config","module","moduleNames","concat","moduleConfig","reduce","moduleClass","toolbar","selector","querySelector","shift","oldDelta","shiftRange","args","emit","lengthOrSource","start","end","transformPosition","map","pos"],"sources":["../../src/core/quill.ts"],"sourcesContent":["import { cloneDeep, merge } from 'lodash-es';\nimport * as Parchment from 'parchment';\nimport type { Op } from 'quill-delta';\nimport Delta from 'quill-delta';\nimport type { BlockEmbed } from '../blots/block';\nimport type Block from '../blots/block';\nimport type Scroll from '../blots/scroll';\nimport type { ScrollConstructor } from '../blots/scroll';\nimport type Clipboard from '../modules/clipboard';\nimport type History from '../modules/history';\nimport type Keyboard from '../modules/keyboard';\nimport type Uploader from '../modules/uploader';\nimport Editor from './editor';\nimport Emitter from './emitter';\nimport type { EmitterSource } from './emitter';\nimport instances from './instances';\nimport logger from './logger';\nimport type { DebugLevel } from './logger';\nimport Module from './module';\nimport Selection, { Range } from './selection';\nimport type { Bounds } from './selection';\nimport Composition from './composition';\nimport Theme from './theme';\nimport type { ThemeConstructor } from './theme';\nimport scrollRectIntoView from './utils/scrollRectIntoView';\nimport type { Rect } from './utils/scrollRectIntoView';\n\nconst debug = logger('quill');\n\nconst globalRegistry = new Parchment.Registry();\nParchment.ParentBlot.uiClass = 'ql-ui';\n\ninterface Options {\n  theme?: string;\n  debug?: DebugLevel | boolean;\n  registry?: Parchment.Registry;\n  readOnly?: boolean;\n  container?: HTMLElement | string;\n  placeholder?: string;\n  bounds?: HTMLElement | string | null;\n  modules?: Record<string, unknown>;\n}\n\ninterface ExpandedOptions extends Omit<Options, 'theme'> {\n  theme: ThemeConstructor;\n  registry: Parchment.Registry;\n  container: HTMLElement;\n  modules: Record<string, unknown>;\n  bounds?: HTMLElement | null;\n}\n\nclass Quill {\n  static DEFAULTS: Partial<Options> = {\n    bounds: null,\n    modules: {},\n    placeholder: '',\n    readOnly: false,\n    registry: globalRegistry,\n    theme: 'default',\n  };\n  static events = Emitter.events;\n  static sources = Emitter.sources;\n  static version = typeof QUILL_VERSION === 'undefined' ? 'dev' : QUILL_VERSION;\n\n  static imports: Record<string, unknown> = {\n    delta: Delta,\n    parchment: Parchment,\n    'core/module': Module,\n    'core/theme': Theme,\n  };\n\n  static debug(limit: DebugLevel | boolean) {\n    if (limit === true) {\n      limit = 'log';\n    }\n    logger.level(limit);\n  }\n\n  static find(node: Node, bubble = false) {\n    return instances.get(node) || globalRegistry.find(node, bubble);\n  }\n\n  static import(name: 'core/module'): typeof Module;\n  static import(name: `themes/${string}`): typeof Theme;\n  static import(name: 'parchment'): typeof Parchment;\n  static import(name: 'delta'): typeof Delta;\n  static import(name: string): unknown;\n  static import(name: string) {\n    if (this.imports[name] == null) {\n      debug.error(`Cannot import ${name}. Are you sure it was registered?`);\n    }\n    return this.imports[name];\n  }\n\n  static register(\n    path:\n      | string\n      | Parchment.BlotConstructor\n      | Parchment.Attributor\n      | Record<string, unknown>,\n    target?: Parchment.BlotConstructor | Parchment.Attributor | boolean,\n    overwrite = false,\n  ) {\n    if (typeof path !== 'string') {\n      const name = 'attrName' in path ? path.attrName : path.blotName;\n      if (typeof name === 'string') {\n        // register(Blot | Attributor, overwrite)\n        // @ts-expect-error\n        this.register(`formats/${name}`, path, target);\n      } else {\n        Object.keys(path).forEach((key) => {\n          // @ts-expect-error\n          this.register(key, path[key], target);\n        });\n      }\n    } else {\n      if (this.imports[path] != null && !overwrite) {\n        debug.warn(`Overwriting ${path} with`, target);\n      }\n      this.imports[path] = target;\n      if (\n        (path.startsWith('blots/') || path.startsWith('formats/')) &&\n        // @ts-expect-error\n        target.blotName !== 'abstract'\n      ) {\n        globalRegistry.register(target);\n      }\n      // @ts-expect-error\n      if (typeof target.register === 'function') {\n        // @ts-expect-error\n        target.register(globalRegistry);\n      }\n    }\n  }\n\n  container: HTMLElement;\n  root: HTMLDivElement;\n  scroll: Scroll;\n  emitter: Emitter;\n  allowReadOnlyEdits: boolean;\n  editor: Editor;\n  composition: Composition;\n  selection: Selection;\n\n  theme: Theme;\n  keyboard: Keyboard;\n  clipboard: Clipboard;\n  history: History;\n  uploader: Uploader;\n\n  options: ExpandedOptions;\n\n  constructor(container: HTMLElement | string, options: Options = {}) {\n    this.options = expandConfig(container, options);\n    this.container = this.options.container;\n    if (this.container == null) {\n      debug.error('Invalid Quill container', container);\n      return;\n    }\n    if (this.options.debug) {\n      Quill.debug(this.options.debug);\n    }\n    const html = this.container.innerHTML.trim();\n    this.container.classList.add('ql-container');\n    this.container.innerHTML = '';\n    instances.set(this.container, this);\n    this.root = this.addContainer('ql-editor');\n    this.root.classList.add('ql-blank');\n    this.emitter = new Emitter();\n    // @ts-expect-error TODO: fix BlotConstructor\n    const ScrollBlot = this.options.registry.query(\n      Parchment.ScrollBlot.blotName,\n    ) as ScrollConstructor;\n    this.scroll = new ScrollBlot(this.options.registry, this.root, {\n      emitter: this.emitter,\n    });\n    this.editor = new Editor(this.scroll);\n    this.selection = new Selection(this.scroll, this.emitter);\n    this.composition = new Composition(this.scroll, this.emitter);\n    this.theme = new this.options.theme(this, this.options); // eslint-disable-line new-cap\n    this.keyboard = this.theme.addModule('keyboard');\n    this.clipboard = this.theme.addModule('clipboard');\n    this.history = this.theme.addModule('history');\n    this.uploader = this.theme.addModule('uploader');\n    this.theme.addModule('input');\n    this.theme.addModule('uiNode');\n    this.theme.init();\n    this.emitter.on(Emitter.events.EDITOR_CHANGE, (type) => {\n      if (type === Emitter.events.TEXT_CHANGE) {\n        this.root.classList.toggle('ql-blank', this.editor.isBlank());\n      }\n    });\n    this.emitter.on(Emitter.events.SCROLL_UPDATE, (source, mutations) => {\n      const oldRange = this.selection.lastRange;\n      const [newRange] = this.selection.getRange();\n      const selectionInfo =\n        oldRange && newRange ? { oldRange, newRange } : undefined;\n      modify.call(\n        this,\n        () => this.editor.update(null, mutations, selectionInfo),\n        source,\n      );\n    });\n    this.emitter.on(Emitter.events.SCROLL_EMBED_UPDATE, (blot, delta) => {\n      const oldRange = this.selection.lastRange;\n      const [newRange] = this.selection.getRange();\n      const selectionInfo =\n        oldRange && newRange ? { oldRange, newRange } : undefined;\n      modify.call(\n        this,\n        () => {\n          const change = new Delta()\n            .retain(blot.offset(this))\n            .retain({ [blot.statics.blotName]: delta });\n          return this.editor.update(change, [], selectionInfo);\n        },\n        Quill.sources.USER,\n      );\n    });\n    if (html) {\n      const contents = this.clipboard.convert({\n        html: `${html}<p><br></p>`,\n        text: '\\n',\n      });\n      this.setContents(contents);\n    }\n    this.history.clear();\n    if (this.options.placeholder) {\n      this.root.setAttribute('data-placeholder', this.options.placeholder);\n    }\n    if (this.options.readOnly) {\n      this.disable();\n    }\n    this.allowReadOnlyEdits = false;\n  }\n\n  addContainer(container: string, refNode?: Node | null): HTMLDivElement;\n  addContainer(container: HTMLElement, refNode?: Node | null): HTMLElement;\n  addContainer(\n    container: string | HTMLElement,\n    refNode: Node | null = null,\n  ): HTMLDivElement | HTMLElement {\n    if (typeof container === 'string') {\n      const className = container;\n      container = document.createElement('div');\n      container.classList.add(className);\n    }\n    this.container.insertBefore(container, refNode);\n    return container;\n  }\n\n  blur() {\n    this.selection.setRange(null);\n  }\n\n  deleteText(range: Range, source?: EmitterSource): Delta;\n  deleteText(index: number, length: number, source?: EmitterSource): Delta;\n  deleteText(\n    index: number | Range,\n    length?: number | EmitterSource,\n    source?: EmitterSource,\n  ): Delta {\n    // @ts-expect-error\n    [index, length, , source] = overload(index, length, source);\n    return modify.call(\n      this,\n      () => {\n        // @ts-expect-error\n        return this.editor.deleteText(index, length);\n      },\n      source,\n      index,\n      -1 * length,\n    );\n  }\n\n  disable() {\n    this.enable(false);\n  }\n\n  editReadOnly<T>(modifier: () => T): T {\n    this.allowReadOnlyEdits = true;\n    const value = modifier();\n    this.allowReadOnlyEdits = false;\n    return value;\n  }\n\n  enable(enabled = true) {\n    this.scroll.enable(enabled);\n    this.container.classList.toggle('ql-disabled', !enabled);\n  }\n\n  focus(options: { preventScroll?: boolean } = {}) {\n    this.selection.focus();\n    if (!options.preventScroll) {\n      this.scrollSelectionIntoView();\n    }\n  }\n\n  format(\n    name: string,\n    value: unknown,\n    source: EmitterSource = Emitter.sources.API,\n  ) {\n    return modify.call(\n      this,\n      () => {\n        const range = this.getSelection(true);\n        let change = new Delta();\n        if (range == null) return change;\n        if (this.scroll.query(name, Parchment.Scope.BLOCK)) {\n          change = this.editor.formatLine(range.index, range.length, {\n            [name]: value,\n          });\n        } else if (range.length === 0) {\n          this.selection.format(name, value);\n          return change;\n        } else {\n          change = this.editor.formatText(range.index, range.length, {\n            [name]: value,\n          });\n        }\n        this.setSelection(range, Emitter.sources.SILENT);\n        return change;\n      },\n      source,\n    );\n  }\n\n  formatLine(\n    index: number,\n    length: number,\n    formats: Record<string, unknown>,\n    source?: EmitterSource,\n  ): Delta;\n  formatLine(\n    index: number,\n    length: number,\n    name: string,\n    value?: unknown,\n    source?: EmitterSource,\n  ): Delta;\n  formatLine(\n    index: number,\n    length: number,\n    name: string | Record<string, unknown>,\n    value?: unknown | EmitterSource,\n    source?: EmitterSource,\n  ): Delta {\n    let formats: Record<string, unknown>;\n    // eslint-disable-next-line prefer-const\n    [index, length, formats, source] = overload(\n      index,\n      length,\n      // @ts-expect-error\n      name,\n      value,\n      source,\n    );\n    return modify.call(\n      this,\n      () => {\n        return this.editor.formatLine(index, length, formats);\n      },\n      source,\n      index,\n      0,\n    );\n  }\n\n  formatText(\n    range: { index: number; length: number },\n    name: string,\n    value: unknown,\n    source?: EmitterSource,\n  ): Delta;\n  formatText(\n    index: number,\n    length: number,\n    name: string,\n    value: unknown,\n    source: EmitterSource,\n  ): Delta;\n  formatText(\n    index: number | { index: number; length: number },\n    length: number | string,\n    name: string | unknown,\n    value?: unknown | EmitterSource,\n    source?: EmitterSource,\n  ): Delta {\n    let formats: Record<string, unknown>;\n    // eslint-disable-next-line prefer-const\n    [index, length, formats, source] = overload(\n      // @ts-expect-error\n      index,\n      length,\n      name,\n      value,\n      source,\n    );\n    return modify.call(\n      this,\n      () => {\n        // @ts-expect-error\n        return this.editor.formatText(index, length, formats);\n      },\n      source,\n      index,\n      0,\n    );\n  }\n\n  getBounds(index: number | Range, length = 0): Bounds | null {\n    let bounds: Bounds | null = null;\n    if (typeof index === 'number') {\n      bounds = this.selection.getBounds(index, length);\n    } else {\n      bounds = this.selection.getBounds(index.index, index.length);\n    }\n    if (!bounds) return null;\n    const containerBounds = this.container.getBoundingClientRect();\n    return {\n      bottom: bounds.bottom - containerBounds.top,\n      height: bounds.height,\n      left: bounds.left - containerBounds.left,\n      right: bounds.right - containerBounds.left,\n      top: bounds.top - containerBounds.top,\n      width: bounds.width,\n    };\n  }\n\n  getContents(index = 0, length = this.getLength() - index) {\n    [index, length] = overload(index, length);\n    return this.editor.getContents(index, length);\n  }\n\n  getFormat(index?: number, length?: number): { [format: string]: unknown };\n  getFormat(range?: { index: number; length: number }): {\n    [format: string]: unknown;\n  };\n  getFormat(\n    index: { index: number; length: number } | number = this.getSelection(true),\n    length = 0,\n  ): { [format: string]: unknown } {\n    if (typeof index === 'number') {\n      return this.editor.getFormat(index, length);\n    }\n    return this.editor.getFormat(index.index, index.length);\n  }\n\n  getIndex(blot: Parchment.Blot) {\n    return blot.offset(this.scroll);\n  }\n\n  getLength() {\n    return this.scroll.length();\n  }\n\n  getLeaf(index: number) {\n    return this.scroll.leaf(index);\n  }\n\n  getLine(index: number) {\n    return this.scroll.line(index);\n  }\n\n  getLines(range: { index: number; length: number }): (Block | BlockEmbed)[];\n  getLines(index?: number, length?: number): (Block | BlockEmbed)[];\n  getLines(\n    index: { index: number; length: number } | number = 0,\n    length = Number.MAX_VALUE,\n  ): (Block | BlockEmbed)[] {\n    if (typeof index !== 'number') {\n      return this.scroll.lines(index.index, index.length);\n    }\n    return this.scroll.lines(index, length);\n  }\n\n  getModule(name: string) {\n    return this.theme.modules[name];\n  }\n\n  getSelection(focus: true): Range;\n  getSelection(focus?: boolean): Range | null;\n  getSelection(focus = false): Range | null {\n    if (focus) this.focus();\n    this.update(); // Make sure we access getRange with editor in consistent state\n    return this.selection.getRange()[0];\n  }\n\n  getSemanticHTML(range: { index: number; length: number }): string;\n  getSemanticHTML(index?: number, length?: number): string;\n  getSemanticHTML(\n    index: { index: number; length: number } | number = 0,\n    length?: number,\n  ) {\n    if (typeof index === 'number') {\n      length = this.getLength() - index;\n    }\n    // @ts-expect-error\n    [index, length] = overload(index, length);\n    return this.editor.getHTML(index, length);\n  }\n\n  getText(range?: { index: number; length: number }): string;\n  getText(index?: number, length?: number): string;\n  getText(\n    index: { index: number; length: number } | number = 0,\n    length?: number,\n  ): string {\n    if (typeof index === 'number') {\n      length = this.getLength() - index;\n    }\n    // @ts-expect-error\n    [index, length] = overload(index, length);\n    return this.editor.getText(index, length);\n  }\n\n  hasFocus() {\n    return this.selection.hasFocus();\n  }\n\n  insertEmbed(\n    index: number,\n    embed: string,\n    value: unknown,\n    source: EmitterSource = Quill.sources.API,\n  ) {\n    return modify.call(\n      this,\n      () => {\n        return this.editor.insertEmbed(index, embed, value);\n      },\n      source,\n      index,\n    );\n  }\n\n  insertText(index: number, text: string, source: EmitterSource): Delta;\n  insertText(\n    index: number,\n    text: string,\n    formats: Record<string, unknown>,\n    source: EmitterSource,\n  ): Delta;\n  insertText(\n    index: number,\n    text: string,\n    name: string,\n    value: unknown,\n    source: EmitterSource,\n  ): Delta;\n  insertText(\n    index: number,\n    text: string,\n    name: string | Record<string, unknown> | EmitterSource,\n    value?: unknown,\n    source?: EmitterSource,\n  ): Delta {\n    let formats: Record<string, unknown>;\n    // eslint-disable-next-line prefer-const\n    // @ts-expect-error\n    [index, , formats, source] = overload(index, 0, name, value, source);\n    return modify.call(\n      this,\n      () => {\n        return this.editor.insertText(index, text, formats);\n      },\n      source,\n      index,\n      text.length,\n    );\n  }\n\n  isEnabled() {\n    return this.scroll.isEnabled();\n  }\n\n  off(...args: Parameters<(typeof Emitter)['prototype']['off']>) {\n    return this.emitter.off(...args);\n  }\n\n  on(\n    event: (typeof Emitter)['events']['TEXT_CHANGE'],\n    handler: (delta: Delta, oldContent: Delta, source: EmitterSource) => void,\n  ): Emitter;\n  on(\n    event: (typeof Emitter)['events']['SELECTION_CHANGE'],\n    handler: (range: Range, oldRange: Range, source: EmitterSource) => void,\n  ): Emitter;\n  // @ts-expect-error\n  on(\n    event: (typeof Emitter)['events']['EDITOR_CHANGE'],\n    handler: (\n      ...args:\n        | [\n            (typeof Emitter)['events']['TEXT_CHANGE'],\n            Delta,\n            Delta,\n            EmitterSource,\n          ]\n        | [\n            (typeof Emitter)['events']['SELECTION_CHANGE'],\n            Range,\n            Range,\n            EmitterSource,\n          ]\n    ) => void,\n  ): Emitter;\n  on(event: string, ...args: unknown[]): Emitter;\n  on(...args: Parameters<(typeof Emitter)['prototype']['on']>): Emitter {\n    return this.emitter.on(...args);\n  }\n\n  once(...args: Parameters<(typeof Emitter)['prototype']['once']>) {\n    return this.emitter.once(...args);\n  }\n\n  removeFormat(...args: Parameters<typeof overload>) {\n    const [index, length, , source] = overload(...args);\n    return modify.call(\n      this,\n      () => {\n        return this.editor.removeFormat(index, length);\n      },\n      source,\n      index,\n    );\n  }\n\n  scrollRectIntoView(rect: Rect) {\n    scrollRectIntoView(this.root, rect);\n  }\n\n  /**\n   * @deprecated Use Quill#scrollSelectionIntoView() instead.\n   */\n  scrollIntoView() {\n    console.warn(\n      'Quill#scrollIntoView() has been deprecated and will be removed in the near future. Please use Quill#scrollSelectionIntoView() instead.',\n    );\n    this.scrollSelectionIntoView();\n  }\n\n  /**\n   * Scroll the current selection into the visible area.\n   * If the selection is already visible, no scrolling will occur.\n   */\n  scrollSelectionIntoView() {\n    const range = this.selection.lastRange;\n    const bounds = range && this.selection.getBounds(range.index, range.length);\n    if (bounds) {\n      this.scrollRectIntoView(bounds);\n    }\n  }\n\n  setContents(\n    delta: Delta | Op[],\n    source: EmitterSource = Emitter.sources.API,\n  ) {\n    return modify.call(\n      this,\n      () => {\n        delta = new Delta(delta);\n        const length = this.getLength();\n        // Quill will set empty editor to \\n\n        const delete1 = this.editor.deleteText(0, length);\n        const applied = this.editor.insertContents(0, delta);\n        // Remove extra \\n from empty editor initialization\n        const delete2 = this.editor.deleteText(this.getLength() - 1, 1);\n        return delete1.compose(applied).compose(delete2);\n      },\n      source,\n    );\n  }\n  setSelection(range: Range | null, source?: EmitterSource): void;\n  setSelection(index: number, source?: EmitterSource): void;\n  setSelection(index: number, length?: number, source?: EmitterSource): void;\n  setSelection(index: number, source?: EmitterSource): void;\n  setSelection(\n    index: Range | null | number,\n    length?: EmitterSource | number,\n    source?: EmitterSource,\n  ): void {\n    if (index == null) {\n      // @ts-expect-error https://github.com/microsoft/TypeScript/issues/22609\n      this.selection.setRange(null, length || Quill.sources.API);\n    } else {\n      // @ts-expect-error\n      [index, length, , source] = overload(index, length, source);\n      this.selection.setRange(new Range(Math.max(0, index), length), source);\n      if (source !== Emitter.sources.SILENT) {\n        this.scrollSelectionIntoView();\n      }\n    }\n  }\n\n  setText(text: string, source: EmitterSource = Emitter.sources.API) {\n    const delta = new Delta().insert(text);\n    return this.setContents(delta, source);\n  }\n\n  update(source: EmitterSource = Emitter.sources.USER) {\n    const change = this.scroll.update(source); // Will update selection before selection.update() does if text changes\n    this.selection.update(source);\n    // TODO this is usually undefined\n    return change;\n  }\n\n  updateContents(\n    delta: Delta | Op[],\n    source: EmitterSource = Emitter.sources.API,\n  ) {\n    return modify.call(\n      this,\n      () => {\n        delta = new Delta(delta);\n        return this.editor.applyDelta(delta);\n      },\n      source,\n      true,\n    );\n  }\n}\n\nfunction expandConfig(\n  container: HTMLElement | string,\n  userConfig: Options,\n): ExpandedOptions {\n  // @ts-expect-error -- TODO fix this later\n  let expandedConfig: ExpandedOptions = merge(\n    {\n      container,\n      modules: {\n        clipboard: true,\n        keyboard: true,\n        history: true,\n        uploader: true,\n      },\n    },\n    userConfig,\n  );\n\n  // @ts-expect-error -- TODO fix this later\n  if (!expandedConfig.theme || expandedConfig.theme === Quill.DEFAULTS.theme) {\n    expandedConfig.theme = Theme;\n  } else {\n    expandedConfig.theme = Quill.import(`themes/${expandedConfig.theme}`);\n    if (expandedConfig.theme == null) {\n      throw new Error(\n        `Invalid theme ${expandedConfig.theme}. Did you register it?`,\n      );\n    }\n  }\n  // @ts-expect-error -- TODO fix this later\n  const themeConfig = cloneDeep(expandedConfig.theme.DEFAULTS);\n  [themeConfig, expandedConfig].forEach((config) => {\n    config.modules = config.modules || {};\n    Object.keys(config.modules).forEach((module) => {\n      if (config.modules[module] === true) {\n        config.modules[module] = {};\n      }\n    });\n  });\n  const moduleNames = Object.keys(themeConfig.modules).concat(\n    Object.keys(expandedConfig.modules),\n  );\n  const moduleConfig = moduleNames.reduce((config, name) => {\n    const moduleClass = Quill.import(`modules/${name}`);\n    if (moduleClass == null) {\n      debug.error(\n        `Cannot load ${name} module. Are you sure you registered it?`,\n      );\n    } else {\n      // @ts-expect-error\n      config[name] = moduleClass.DEFAULTS || {};\n    }\n    return config;\n  }, {});\n  // Special case toolbar shorthand\n  if (\n    expandedConfig.modules != null &&\n    expandedConfig.modules.toolbar &&\n    expandedConfig.modules.toolbar.constructor !== Object\n  ) {\n    expandedConfig.modules.toolbar = {\n      container: expandedConfig.modules.toolbar,\n    };\n  }\n  expandedConfig = merge(\n    {},\n    Quill.DEFAULTS,\n    { modules: moduleConfig },\n    themeConfig,\n    expandedConfig,\n  );\n  (['bounds', 'container'] as const).forEach((key) => {\n    const selector = expandedConfig[key];\n    if (typeof selector === 'string') {\n      // @ts-expect-error Handle null case\n      expandedConfig[key] = document.querySelector(selector) as HTMLElement;\n    }\n  });\n  expandedConfig.modules = Object.keys(expandedConfig.modules).reduce(\n    (config: Record<string, unknown>, name) => {\n      if (expandedConfig.modules[name]) {\n        config[name] = expandedConfig.modules[name];\n      }\n      return config;\n    },\n    {},\n  );\n  return expandedConfig;\n}\n\n// Handle selection preservation and TEXT_CHANGE emission\n// common to modification APIs\nfunction modify(\n  modifier: () => Delta,\n  source: EmitterSource,\n  index: number | boolean,\n  shift: number | null,\n) {\n  if (\n    !this.isEnabled() &&\n    source === Emitter.sources.USER &&\n    !this.allowReadOnlyEdits\n  ) {\n    return new Delta();\n  }\n  let range = index == null ? null : this.getSelection();\n  const oldDelta = this.editor.delta;\n  const change = modifier();\n  if (range != null) {\n    if (index === true) {\n      index = range.index; // eslint-disable-line prefer-destructuring\n    }\n    if (shift == null) {\n      range = shiftRange(range, change, source);\n    } else if (shift !== 0) {\n      // @ts-expect-error index should always be number\n      range = shiftRange(range, index, shift, source);\n    }\n    this.setSelection(range, Emitter.sources.SILENT);\n  }\n  if (change.length() > 0) {\n    const args = [Emitter.events.TEXT_CHANGE, change, oldDelta, source];\n    this.emitter.emit(Emitter.events.EDITOR_CHANGE, ...args);\n    if (source !== Emitter.sources.SILENT) {\n      this.emitter.emit(...args);\n    }\n  }\n  return change;\n}\n\ntype NormalizedIndexLength = [\n  number,\n  number,\n  Record<string, unknown>,\n  EmitterSource,\n];\nfunction overload(index: number, source?: EmitterSource): NormalizedIndexLength;\nfunction overload(\n  index: number,\n  length: number,\n  source?: EmitterSource,\n): NormalizedIndexLength;\nfunction overload(\n  index: number,\n  length: number,\n  format: string,\n  value: unknown,\n  source?: EmitterSource,\n): NormalizedIndexLength;\nfunction overload(\n  index: number,\n  length: number,\n  format: Record<string, unknown>,\n  source?: EmitterSource,\n): NormalizedIndexLength;\nfunction overload(range: Range, source?: EmitterSource): NormalizedIndexLength;\nfunction overload(\n  range: Range,\n  format: string,\n  value: unknown,\n  source?: EmitterSource,\n): NormalizedIndexLength;\nfunction overload(\n  range: Range,\n  format: Record<string, unknown>,\n  source?: EmitterSource,\n): NormalizedIndexLength;\nfunction overload(\n  index: Range | number,\n  length?: number | string | Record<string, unknown> | EmitterSource,\n  name?: string | unknown | Record<string, unknown> | EmitterSource,\n  value?: unknown | EmitterSource,\n  source?: EmitterSource,\n): NormalizedIndexLength {\n  let formats: Record<string, unknown> = {};\n  // @ts-expect-error\n  if (typeof index.index === 'number' && typeof index.length === 'number') {\n    // Allow for throwaway end (used by insertText/insertEmbed)\n    if (typeof length !== 'number') {\n      // @ts-expect-error\n      source = value;\n      value = name;\n      name = length;\n      // @ts-expect-error\n      length = index.length; // eslint-disable-line prefer-destructuring\n      // @ts-expect-error\n      index = index.index; // eslint-disable-line prefer-destructuring\n    } else {\n      // @ts-expect-error\n      length = index.length; // eslint-disable-line prefer-destructuring\n      // @ts-expect-error\n      index = index.index; // eslint-disable-line prefer-destructuring\n    }\n  } else if (typeof length !== 'number') {\n    // @ts-expect-error\n    source = value;\n    value = name;\n    name = length;\n    length = 0;\n  }\n  // Handle format being object, two format name/value strings or excluded\n  if (typeof name === 'object') {\n    // @ts-expect-error Fix me later\n    formats = name;\n    // @ts-expect-error\n    source = value;\n  } else if (typeof name === 'string') {\n    if (value != null) {\n      formats[name] = value;\n    } else {\n      // @ts-expect-error\n      source = name;\n    }\n  }\n  // Handle optional source\n  source = source || Emitter.sources.API;\n  // @ts-expect-error\n  return [index, length, formats, source];\n}\n\nfunction shiftRange(range: Range, change: Delta, source?: EmitterSource): Range;\nfunction shiftRange(\n  range: Range,\n  index: number,\n  length?: number,\n  source?: EmitterSource,\n): Range;\nfunction shiftRange(\n  range: Range,\n  index: number | Delta,\n  lengthOrSource?: number | EmitterSource,\n  source?: EmitterSource,\n) {\n  const length = typeof lengthOrSource === 'number' ? lengthOrSource : 0;\n  if (range == null) return null;\n  let start;\n  let end;\n  // @ts-expect-error -- TODO: add a better type guard around `index`\n  if (index && typeof index.transformPosition === 'function') {\n    [start, end] = [range.index, range.index + range.length].map((pos) =>\n      // @ts-expect-error -- TODO: add a better type guard around `index`\n      index.transformPosition(pos, source !== Emitter.sources.USER),\n    );\n  } else {\n    [start, end] = [range.index, range.index + range.length].map((pos) => {\n      // @ts-expect-error -- TODO: add a better type guard around `index`\n      if (pos < index || (pos === index && source === Emitter.sources.USER))\n        return pos;\n      if (length >= 0) {\n        return pos + length;\n      }\n      // @ts-expect-error -- TODO: add a better type guard around `index`\n      return Math.max(index, pos + length);\n    });\n  }\n  return new Range(start, end - start);\n}\n\nexport { globalRegistry, expandConfig, overload, Quill as default };\n"],"mappings":"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"}