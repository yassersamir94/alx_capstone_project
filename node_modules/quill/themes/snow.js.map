{"version":3,"file":"snow.js","names":["_lodashEs","require","_emitter","_interopRequireDefault","_base","_interopRequireWildcard","_link","_selection","_icons","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","obj","TOOLBAR_CONFIG","header","list","SnowTooltip","BaseTooltip","TEMPLATE","join","preview","root","querySelector","listen","addEventListener","event","classList","contains","save","edit","textContent","preventDefault","linkRange","range","restoreFocus","quill","formatText","Emitter","sources","USER","hide","on","events","SELECTION_CHANGE","oldRange","source","length","link","offset","scroll","descendant","LinkBlot","index","Range","formats","domNode","setAttribute","show","bounds","getBounds","position","removeAttribute","SnowTheme","BaseTheme","constructor","options","modules","toolbar","container","add","extendToolbar","buildButtons","querySelectorAll","icons","buildPickers","tooltip","keyboard","addBinding","key","shortKey","_range","context","handlers","format","DEFAULTS","merge","value","getSelection","getText","test","indexOf","theme","_default","exports"],"sources":["../../src/themes/snow.ts"],"sourcesContent":["import { merge } from 'lodash-es';\nimport Emitter from '../core/emitter';\nimport BaseTheme, { BaseTooltip } from './base';\nimport LinkBlot from '../formats/link';\nimport { Range } from '../core/selection';\nimport icons from '../ui/icons';\nimport type Quill from '../core';\nimport type { Context } from '../modules/keyboard';\nimport type Toolbar from '../modules/toolbar';\nimport type { ToolbarConfig } from '../modules/toolbar';\nimport type { ThemeOptions } from '../core/theme';\n\nconst TOOLBAR_CONFIG: ToolbarConfig = [\n  [{ header: ['1', '2', '3', false] }],\n  ['bold', 'italic', 'underline', 'link'],\n  [{ list: 'ordered' }, { list: 'bullet' }],\n  ['clean'],\n];\n\nclass SnowTooltip extends BaseTooltip {\n  static TEMPLATE = [\n    '<a class=\"ql-preview\" rel=\"noopener noreferrer\" target=\"_blank\" href=\"about:blank\"></a>',\n    '<input type=\"text\" data-formula=\"e=mc^2\" data-link=\"https://quilljs.com\" data-video=\"Embed URL\">',\n    '<a class=\"ql-action\"></a>',\n    '<a class=\"ql-remove\"></a>',\n  ].join('');\n\n  preview = this.root.querySelector('a.ql-preview');\n\n  listen() {\n    super.listen();\n    // @ts-expect-error Fix me later\n    this.root\n      .querySelector('a.ql-action')\n      .addEventListener('click', (event) => {\n        if (this.root.classList.contains('ql-editing')) {\n          this.save();\n        } else {\n          // @ts-expect-error Fix me later\n          this.edit('link', this.preview.textContent);\n        }\n        event.preventDefault();\n      });\n    // @ts-expect-error Fix me later\n    this.root\n      .querySelector('a.ql-remove')\n      .addEventListener('click', (event) => {\n        if (this.linkRange != null) {\n          const range = this.linkRange;\n          this.restoreFocus();\n          this.quill.formatText(range, 'link', false, Emitter.sources.USER);\n          delete this.linkRange;\n        }\n        event.preventDefault();\n        this.hide();\n      });\n    this.quill.on(\n      Emitter.events.SELECTION_CHANGE,\n      (range, oldRange, source) => {\n        if (range == null) return;\n        if (range.length === 0 && source === Emitter.sources.USER) {\n          const [link, offset] = this.quill.scroll.descendant(\n            LinkBlot,\n            range.index,\n          );\n          if (link != null) {\n            this.linkRange = new Range(range.index - offset, link.length());\n            const preview = LinkBlot.formats(link.domNode);\n            // @ts-expect-error Fix me later\n            this.preview.textContent = preview;\n            // @ts-expect-error Fix me later\n            this.preview.setAttribute('href', preview);\n            this.show();\n            const bounds = this.quill.getBounds(this.linkRange);\n            if (bounds != null) {\n              this.position(bounds);\n            }\n            return;\n          }\n        } else {\n          delete this.linkRange;\n        }\n        this.hide();\n      },\n    );\n  }\n\n  show() {\n    super.show();\n    this.root.removeAttribute('data-mode');\n  }\n}\n\nclass SnowTheme extends BaseTheme {\n  constructor(quill: Quill, options: ThemeOptions) {\n    if (\n      options.modules.toolbar != null &&\n      options.modules.toolbar.container == null\n    ) {\n      options.modules.toolbar.container = TOOLBAR_CONFIG;\n    }\n    super(quill, options);\n    this.quill.container.classList.add('ql-snow');\n  }\n\n  extendToolbar(toolbar: Toolbar) {\n    if (toolbar.container != null) {\n      toolbar.container.classList.add('ql-snow');\n      this.buildButtons(toolbar.container.querySelectorAll('button'), icons);\n      this.buildPickers(toolbar.container.querySelectorAll('select'), icons);\n      // @ts-expect-error\n      this.tooltip = new SnowTooltip(this.quill, this.options.bounds);\n      if (toolbar.container.querySelector('.ql-link')) {\n        this.quill.keyboard.addBinding(\n          { key: 'k', shortKey: true },\n          (_range: Range, context: Context) => {\n            toolbar.handlers.link.call(toolbar, !context.format.link);\n          },\n        );\n      }\n    }\n  }\n}\nSnowTheme.DEFAULTS = merge({}, BaseTheme.DEFAULTS, {\n  modules: {\n    toolbar: {\n      handlers: {\n        link(value: string) {\n          if (value) {\n            const range = this.quill.getSelection();\n            if (range == null || range.length === 0) return;\n            let preview = this.quill.getText(range);\n            if (\n              /^\\S+@\\S+\\.\\S+$/.test(preview) &&\n              preview.indexOf('mailto:') !== 0\n            ) {\n              preview = `mailto:${preview}`;\n            }\n            const { tooltip } = this.quill.theme;\n            tooltip.edit('link', preview);\n          } else {\n            this.quill.format('link', false);\n          }\n        },\n      },\n    },\n  },\n});\n\nexport default SnowTheme;\n"],"mappings":"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"}